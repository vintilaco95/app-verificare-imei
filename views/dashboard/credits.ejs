<%- include('../partials/header', { title: t('dashboard.credits.pageTitle'), user: user }) %>

<div class="dashboard-container">
  <div class="dashboard-header">
    <h1><%= t('dashboard.credits.heading') %></h1>
    <div class="credits-display">
      <p class="credits-label"><%= t('dashboard.credits.labels.available') %></p>
      <p class="credits-value"><%= user.credits.toFixed(2) %></p>
    </div>
    <a href="/dashboard/credits/topup" class="btn btn-primary btn-large"><%= t('dashboard.credits.actions.topupCard') %></a>
  </div>

  <% if (errors && errors.length > 0) { %>
    <div class="error-box">
      <ul>
        <% errors.forEach(error => { %>
          <li><%= error.msg %></li>
        <% }); %>
      </ul>
    </div>
  <% } %>

  <div class="topup-packages">
    <h2><%= t('dashboard.credits.packages.title') %></h2>
    <div class="package-grid">
      <% packages.forEach(pkg => { %>
        <div class="package-card">
          <h3><%= pkg.label %></h3>
          <p class="package-credits"><%= pkg.credits %> <%= t('common.labels.credits') %></p>
          <p class="package-description"><%= pkg.description %></p>
          <p class="package-price"><%= pkg.price.toFixed(2) %> RON</p>
          <form action="/dashboard/credits/topup" method="POST">
            <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
            <input type="hidden" name="packageId" value="<%= pkg.id %>">
            <button type="submit" class="btn btn-primary btn-block"><%= t('dashboard.credits.actions.payCard') %></button>
          </form>
        </div>
      <% }); %>
    </div>
    <div class="custom-package">
      <p><%= t('dashboard.credits.packages.customText') %></p>
      <a href="/dashboard/credits/topup" class="btn btn-secondary"><%= t('dashboard.credits.packages.customAction') %> â†’</a>
    </div>
  </div>

  <div class="transactions-section">
    <h2><%= t('dashboard.credits.transactions.title') %></h2>
    <% if (transactions.length > 0) { %>
      <div class="transactions-table">
        <% transactions.forEach(transaction => { %>
          <div class="transaction-item">
            <div class="transaction-info">
              <p class="transaction-desc"><%= transaction.description %></p>
              <p class="transaction-date"><%= new Date(transaction.createdAt).toLocaleString(currentLang === 'en' ? 'en-US' : 'ro-RO') %></p>
            </div>
            <div class="transaction-amount <%= transaction.type === 'purchase' ? 'positive' : transaction.type === 'refund' ? 'positive' : 'negative' %>">
              <%= transaction.type === 'purchase' || transaction.type === 'refund' ? '+' : '' %><%= transaction.amount.toFixed(2) %> <%= t('common.labels.credits') %>
            </div>
          </div>
        <% }); %>
      </div>
    <% } else { %>
      <p class="empty-state"><%= t('dashboard.credits.transactions.empty') %></p>
    <% } %>
  </div>
</div>

<%- include('../partials/footer') %>
