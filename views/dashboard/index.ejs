<%- include('../partials/header', { title: t('dashboard.overview.pageTitle'), user: user }) %>

<div class="dashboard-container">
  <div class="dashboard-header">
    <h1><%= t('dashboard.overview.heading') %></h1>
    <p><%= t('dashboard.overview.welcome') %>, <%= user.email %>!</p>
    <a href="/dashboard/credits/topup" class="btn btn-primary"><%= t('dashboard.overview.actions.topup') %></a>
  </div>

  <div class="dashboard-stats">
    <div class="stat-card">
      <div class="stat-icon">ðŸ“±</div>
      <div class="stat-content">
        <h3><%= t('dashboard.overview.stats.totalChecks') %></h3>
        <p class="stat-value"><%= typeof totalOrders !== 'undefined' ? totalOrders : orders.length %></p>
        <a href="/dashboard/orders" class="stat-link"><%= t('dashboard.overview.stats.totalChecksLink') %> â†’</a>
      </div>
    </div>
    
    <div class="stat-card">
      <div class="stat-icon">ðŸ’°</div>
      <div class="stat-content">
        <h3><%= t('dashboard.overview.stats.creditsAvailable') %></h3>
        <p class="stat-value"><%= user.credits.toFixed(2) %></p>
        <a href="/dashboard/credits" class="stat-link"><%= t('dashboard.overview.stats.creditsLink') %> â†’</a>
      </div>
    </div>
  </div>

  <div class="dashboard-sections">
    <div class="dashboard-section">
      <div class="section-header">
        <h2><%= t('dashboard.overview.recentChecks.title') %></h2>
        <span class="section-subtitle"><%= t('dashboard.overview.recentChecks.subtitle') %></span>
      </div>
      <% if (orders.length > 0) { %>
        <div class="orders-list">
          <% orders.forEach(order => { %>
            <div class="order-item">
              <div class="order-info">
                <p class="order-imei"><strong>IMEI:</strong> <%= order.imei %></p>
                <p class="order-model"><%= order.model || t('common.labels.unknown') %></p>
                <p class="order-date"><%= new Date(order.createdAt).toLocaleDateString(currentLang === 'en' ? 'en-US' : 'ro-RO') %></p>
              </div>
              <div class="order-status">
                <span class="status-badge status-<%= order.status %>">
                  <%= t(`status.${order.status}`) %>
                </span>
                <% if (order.status === 'success' || order.status === 'failed') { %>
                  <a href="/verify/result/<%= order._id %>" class="btn btn-sm"><%= t('dashboard.overview.recentChecks.actions.viewResult') %></a>
                <% } else if (order.status === 'pending') { %>
                  <a href="/verify/processing/<%= order._id %>" class="btn btn-sm"><%= t('dashboard.overview.recentChecks.actions.viewStatus') %></a>
                <% } else { %>
                  <span class="btn btn-sm" style="opacity: 0.5; cursor: not-allowed;">N/A</span>
                <% } %>
              </div>
            </div>
          <% }); %>
        </div>
        <a href="/dashboard/orders" class="btn btn-secondary"><%= t('dashboard.overview.recentChecks.actions.viewAll') %></a>
      <% } else { %>
        <p class="empty-state"><%= t('dashboard.overview.recentChecks.empty') %></p>
        <a href="/verify/imei" class="btn btn-primary"><%= t('dashboard.overview.recentChecks.actions.checkFirst') %></a>
      <% } %>
    </div>

    <div class="dashboard-section">
      <div class="section-header">
        <h2><%= t('dashboard.overview.recentTransactions.title') %></h2>
        <span class="section-subtitle"><%= t('dashboard.overview.recentTransactions.subtitle') %></span>
      </div>
      <% if (transactions.length > 0) { %>
        <div class="transactions-list">
          <% transactions.forEach(transaction => { %>
            <% const hasOrderLink = transaction.orderId && transaction.orderId._id; %>
            <% const transactionLink = hasOrderLink ? `/verify/result/${transaction.orderId._id}` : null; %>
            <div class="transaction-item-wrapper">
              <% if (transactionLink) { %>
                <a href="<%= transactionLink %>" class="transaction-item transaction-link">
              <% } else { %>
                <div class="transaction-item">
              <% } %>
                  <div class="transaction-info">
                    <p class="transaction-desc"><%= transaction.description %></p>
                    <p class="transaction-date"><%= new Date(transaction.createdAt).toLocaleString(currentLang === 'en' ? 'en-US' : 'ro-RO', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' }) %></p>
                  </div>
                  <div class="transaction-amount <%= transaction.type === 'purchase' || transaction.type === 'refund' ? 'positive' : 'negative' %>">
                    <%= (transaction.type === 'purchase' || transaction.type === 'refund') ? '+' : '' %><%= transaction.amount.toFixed(2) %> <%= t('common.labels.credits') %>
                  </div>
              <% if (transactionLink) { %>
                </a>
              <% } else { %>
              </div>
              <% } %>
            </div>
          <% }); %>
        </div>
        <a href="/dashboard/credits" class="btn btn-secondary"><%= t('dashboard.overview.recentTransactions.actions.viewAll') %></a>
      <% } else { %>
        <p class="empty-state"><%= t('dashboard.overview.recentTransactions.empty') %></p>
      <% } %>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
