<% const isEmailView = typeof isEmail !== 'undefined' && isEmail; %>
<% if (!isEmailView) { 
  const headerProps = {
    title: title,
    user: user,
    csrfToken: typeof csrfToken !== 'undefined' ? csrfToken : '',
    t: typeof t === 'function' ? t : null,
    currentLang: typeof currentLang !== 'undefined' ? currentLang : null,
    currentLangLabel: typeof currentLangLabel !== 'undefined' ? currentLangLabel : null,
    switchLang: typeof switchLang !== 'undefined' ? switchLang : null,
    switchLangLabel: typeof switchLangLabel !== 'undefined' ? switchLangLabel : null
  };
%>
  <%- include('../partials/header', headerProps) %>
<% } %>

<div class="result-container">
  <% 
    const tt = (key) => typeof t === 'function' ? t(key) : key;
    // Parse Samsung data from HTML result (data should be pre-parsed in route)
    const samsungData = typeof samsungParsedData !== 'undefined' ? samsungParsedData : {};
    const riskScoreMaxValue = typeof riskScoreMax !== 'undefined'
      ? riskScoreMax
      : (typeof templateData !== 'undefined' && typeof templateData.riskScoreMax !== 'undefined' ? templateData.riskScoreMax : 10);
    
    // Critical information is already formatted in route handler
    // Use passed variables: iCloud, blacklist, knox, mdm, lostMode, networkLock, warranty, origin
    
    // Use Marketing Name from service 21, fallback to modelDesc/model
    const model = samsungData.marketingName || samsungData.modelDesc || samsungData.model || 'Dispozitiv necunoscut';
    const fullName = samsungData.fullName || '';
    const modelCode = samsungData.modelCode || '';
    const manufacturer = samsungData.manufacturer || '';
    const modelNumber = samsungData.modelNumber || '';
    const imei = samsungData.imei || order.imei;
    const imei2 = samsungData.imei2 || '';
    const serial = samsungData.serial || '';
    const doNumber = samsungData.doNumber || '';
    const productionDate = samsungData.productionDate || '';
    const purchaseDate = samsungData.purchaseDate || '';
    const warrantyUntil = samsungData.warrantyUntil || '';
    const warrantyStatus = samsungData.warrantyStatus || '';
    const salesBuyerCode = samsungData.salesBuyerCode || '';
    const salesBuyerName = samsungData.salesBuyerName || '';
    const carrier = samsungData.carrier || '';
    const soldByCountry = samsungData.soldByCountry || '';
    const shipToCountry = samsungData.shipToCountry || '';
    const soldDate = samsungData.soldDate || '';
    const shipDate = samsungData.shipDate || '';
    const hasProvenanceReport = Array.isArray(order && order.additionalServices) && order.additionalServices.includes(9);
    const showProvenanceUpsell = user && !hasProvenanceReport;
    const provenanceCreditsValue = typeof provenancePrice !== 'undefined' ? Number(provenancePrice || 0) : 0;
    const formattedProvenanceCredits = provenanceCreditsValue.toFixed(2);
    const provenanceButtonLabel = `${tt('verify.result.actions.enhanceBase')} (+${formattedProvenanceCredits} ${tt('common.labels.credits')})`;
    const provenanceButtonConfirm = tt('verify.result.actions.enhanceConfirm').replace('{price}', formattedProvenanceCredits);
    const provenanceButtonProcessing = tt('verify.result.actions.enhanceProcessing');
    const provenanceButtonError = tt('verify.result.actions.enhanceError');
  %>

  <div class="imei-report">
    <!-- HEADER -->
    <div class="report-header">
      <div class="header-content">
        <p class="report-label">Rezultat verificare IMEI</p>
        <h2 class="report-model"><%= model %></h2>
        <% if (fullName) { %>
          <p class="report-desc">Full Name: <strong><%= fullName %></strong></p>
        <% } %>
        <% if (modelCode) { %>
          <p class="report-desc">Model Code: <strong><%= modelCode %></strong></p>
        <% } %>
      </div>
      <div class="report-actions">
        <% if (showProvenanceUpsell) { %>
          <button
            type="button"
            class="btn btn-primary btn-provenance"
            id="verify-provenance-btn"
            data-order-id="<%= order._id %>"
            data-label="<%= provenanceButtonLabel %>"
            data-confirm="<%= provenanceButtonConfirm %>"
            data-processing="<%= provenanceButtonProcessing %>"
            data-error="<%= provenanceButtonError %>">
            <span class="btn-text"><%= tt('verify.result.actions.enhanceBase') %></span>
            <span class="btn-price">+<%= formattedProvenanceCredits %> <%= tt('common.labels.credits') %></span>
          </button>
        <% } %>
        <div class="score-box">
          <p class="score-label">Scor siguran»õƒÉ</p>
          <p class="score-value" style="color: <%= typeof scoreColor !== 'undefined' ? scoreColor : '#22c55e' %>;"><%= typeof riskScore !== 'undefined' ? riskScore : '9' %> / <%= riskScoreMaxValue %></p>
          <p class="score-text" style="color: <%= typeof scoreColor !== 'undefined' ? scoreColor : '#22c55e' %>;"><%= typeof riskText !== 'undefined' ? riskText : 'Telefon sigur' %></p>
        </div>
      </div>
    </div>

    <!-- INFORMATII CRITICE DE SECURITATE -->
    <% 
      // Ensure all critical variables are defined with defaults
      const blacklistSafe = typeof blacklist !== 'undefined' && blacklist ? blacklist : { status: 'unknown', text: 'Nu avem informa»õii despre statusul blacklist' };
      const knoxSafe = typeof knox !== 'undefined' ? knox : null;
      const mdmSafe = typeof mdm !== 'undefined' ? mdm : null;
      const networkLockSafe = typeof networkLock !== 'undefined' && networkLock ? networkLock : { status: 'unknown', text: 'Nu avem informa»õii despre blocarea re»õelei' };
      const warrantySafe = typeof warranty !== 'undefined' && warranty ? warranty : { hasInfo: false, text: 'Nu avem informa»õii despre garan»õie' };
      const originSafe = typeof origin !== 'undefined' && origin ? origin : { hasInfo: false, text: 'Nu avem informa»õii despre provenien»õƒÉ' };
    %>
    <div class="critical-info-section">
      <div class="critical-info-card">
        <h3 class="critical-info-title">üîí Informa»õii Critice de Securitate</h3>
        
        <div class="critical-info-grid">
          <!-- 1. Blacklist Status -->
          <div class="critical-info-item">
            <div class="critical-info-label">Status Blacklist:</div>
            <div class="critical-info-value status-<%= blacklistSafe.status === 'blacklisted' ? 'danger' : blacklistSafe.status === 'clean' ? 'safe' : 'unknown' %>">
              <%= blacklistSafe.text %>
            </div>
          </div>
          
          <!-- 2. Knox Guard -->
          <% if (knoxSafe) { %>
          <div class="critical-info-item">
            <div class="critical-info-label">Knox Guard:</div>
            <div class="critical-info-value status-<%= knoxSafe.status === 'active' ? 'warning' : knoxSafe.status === 'inactive' ? 'safe' : 'unknown' %>">
              <%= knoxSafe.text %>
            </div>
          </div>
          <% } %>
          
          <!-- 3. MDM Lock -->
          <% if (mdmSafe) { %>
          <div class="critical-info-item">
            <div class="critical-info-label">MDM Lock:</div>
            <div class="critical-info-value status-<%= mdmSafe.status === 'locked' ? 'warning' : mdmSafe.status === 'unlocked' ? 'safe' : 'unknown' %>">
              <%= mdmSafe.text %>
            </div>
          </div>
          <% } %>
          
          <!-- 4. Network Lock -->
          <div class="critical-info-item">
            <div class="critical-info-label">Blocare Re»õea:</div>
            <div class="critical-info-value status-<%= networkLockSafe.status === 'locked' ? 'danger' : networkLockSafe.status === 'locked_orange' ? 'warning' : networkLockSafe.status === 'unlocked' ? 'safe' : 'unknown' %>">
              <%= networkLockSafe.text %>
            </div>
          </div>
          
          <!-- 5. Warranty Info -->
          <div class="critical-info-item">
            <div class="critical-info-label">Garan»õie:</div>
            <div class="critical-info-value status-<%= warrantySafe.hasInfo ? (warrantySafe.status === 'active' ? 'safe' : warrantySafe.status === 'expired' ? 'warning' : 'unknown') : 'unknown' %>">
              <%= warrantySafe.text %>
            </div>
          </div>
          
          <!-- 6. Origin Info -->
          <div class="critical-info-item">
            <div class="critical-info-label">Provenien»õƒÉ:</div>
            <div class="critical-info-value <%= originSafe.hasInfo ? '' : 'status-unknown' %>">
              <%= originSafe.text %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ALERTE (dacƒÉ sunt probleme critice) -->
    <% if (blacklistSafe && blacklistSafe.status === 'blacklisted') { %>
      <div class="alert-box" style="background-color: rgba(239, 68, 68, 0.1); border-left-color: #ef4444;">
        <div class="alert-icon">üö´</div>
        <div class="alert-content">
          <p><strong>Dispozitiv Blocat/Furat</strong></p>
          <p>Dispozitivul este √Ænregistrat √Æn baza de date ca blocat sau furat. <strong>NU CUMPƒÇRA</strong> acest dispozitiv.</p>
        </div>
      </div>
    <% } %>
    
    <% if (knoxSafe && knoxSafe.status === 'active') { %>
      <div class="alert-box">
        <div class="alert-icon">‚ö†Ô∏è</div>
        <div class="alert-content">
          <p><strong>Samsung Knox Guard este ACTIV.</strong></p>
          <p>Dispozitivul este √Ænregistrat √Æn sistemul Samsung Knox Guard »ôi poate fi supus unor politici de blocare sau monitorizare.</p>
        </div>
      </div>
    <% } %>

    <!-- INFORMATII SUPLIMENTARE -->
    <div class="report-grid">
      <!-- IDENTIFICARE -->
      <div class="report-card">
        <h3>Identificare dispozitiv</h3>
        <p>Marketing Name: <strong><%= model %></strong></p>
        <% if (fullName) { %>
          <p>Full Name: <strong><%= fullName %></strong></p>
        <% } %>
        <% if (modelCode) { %>
          <p>Model Code: <strong><%= modelCode %></strong></p>
        <% } %>
        <% if (modelNumber) { %>
          <p>Model Number: <strong><%= modelNumber %></strong></p>
        <% } %>
        <% if (manufacturer) { %>
          <p>Manufacturer: <strong><%= manufacturer %></strong></p>
        <% } %>
        <p>IMEI: <strong><%= imei %></strong></p>
        <% if (imei2) { %>
          <p>IMEI secundar: <strong><%= imei2 %></strong></p>
        <% } %>
        <% if (serial) { %>
          <p>Serial Number: <strong><%= serial %></strong></p>
        <% } %>
        <% if (doNumber) { %>
          <p>DO Number: <strong><%= doNumber %></strong></p>
        <% } %>
      </div>
      
      <!-- GARAN»öIE & ACHIZI»öIE -->
      <div class="report-card">
        <h3>Garan»õie & achizi»õie</h3>
        <% if (warrantyStatus) { %>
          <p>Status garan»õie: <strong><%= warrantyStatus %></strong></p>
        <% } %>
        <% if (warrantyUntil) { %>
          <p>Garan»õie p√¢nƒÉ la: <strong><%= warrantyUntil %></strong></p>
        <% } %>
        <% if (purchaseDate) { %>
          <p>Data achizi»õie: <strong><%= purchaseDate %></strong></p>
        <% } %>
        <% if (productionDate) { %>
          <p>Data produc»õie: <strong><%= productionDate %></strong></p>
        <% } %>
        <% if (soldDate) { %>
          <p>Data v√¢nzare: <strong><%= soldDate %></strong></p>
        <% } %>
        <% if (shipDate) { %>
          <p>Data expediere: <strong><%= shipDate %></strong></p>
        <% } %>
      </div>
      
      <!-- DISTRIBU»öIE & V√ÇNZƒÇTOR -->
      <% if (salesBuyerName || salesBuyerCode || soldByCountry || shipToCountry || carrier) { %>
      <div class="report-card">
        <h3>Distribu»õie & v√¢nzƒÉtor</h3>
        <% if (salesBuyerName) { %>
          <p>V√¢nzƒÉtor: <strong><%= salesBuyerName %></strong></p>
        <% } %>
        <% if (salesBuyerCode) { %>
          <p>Cod v√¢nzƒÉtor: <strong><%= salesBuyerCode %></strong></p>
        <% } %>
        <% if (carrier) { %>
          <p>Operator: <strong><%= carrier %></strong></p>
        <% } %>
        <% if (soldByCountry) { %>
          <p>»öarƒÉ v√¢nzare: <strong><%= soldByCountry %></strong></p>
        <% } %>
        <% if (shipToCountry) { %>
          <p>»öarƒÉ expediere: <strong><%= shipToCountry %></strong></p>
        <% } %>
      </div>
      <% } %>
    </div>

    <!-- SFATURI -->
    <div class="report-tips">
      <h3>Sfaturi pentru cumpƒÉrƒÉtor</h3>
      <ol>
        <li>VerificƒÉ dacƒÉ Samsung Knox Guard este dezactivat (ar trebui sƒÉ fie OFF).</li>
        <li>ReseteazƒÉ complet dispozitivul »ôi verificƒÉ dacƒÉ nu mai cere cont vechi.</li>
        <li>VerificƒÉ factura »ôi provenien»õa.</li>
        <li>TesteazƒÉ toate func»õiile hardware, inclusiv S Pen pentru modelele compatibile.</li>
        <li>VerificƒÉ starea bateriei √Æn setƒÉri »ôi numƒÉrul de cicluri de √ÆncƒÉrcare.</li>
        <li>AsigurƒÉ-te cƒÉ dispozitivul este deblocat (Factory Unlocked).</li>
      </ol>
    </div>

    <!-- CONCLUZIE -->
    <div class="report-conclusion">
      <div class="conclusion-box">
        <p><strong>Concluzie:</strong> <%= typeof summaryText !== 'undefined' ? summaryText : 'Dispozitivul este √Æn regulƒÉ pentru achizi»õie.' %></p>
      </div>
    </div>

    <!-- DATE SERVICIU 9 (PROVENIEN»öƒÇ »òI RISC) -->
    <% 
      // Check if service9Data exists - handle both object and string formats
      let service9Data = null;
      if (order.object) {
        // If order.object is a string, try to parse it
        if (typeof order.object === 'string') {
          try {
            const parsed = JSON.parse(order.object);
            service9Data = parsed.service9Data;
          } catch (e) {
            // Not JSON, ignore
          }
        } else if (typeof order.object === 'object') {
          service9Data = order.object.service9Data;
        }
      }
    %>
    <% if (service9Data) { %>
      <% const service9 = service9Data; %>
      <div class="service9-section" style="margin-top: 30px; padding: 20px; background: rgba(59, 130, 246, 0.1); border-radius: 12px; border-left: 4px solid #3b82f6;">
        <h2 class="section-title" style="color: #3b82f6; margin-bottom: 20px;">
          üìã Informa»õii Detaliate Provenien»õƒÉ »ôi Riscul de Blocare (GSX)
        </h2>
        
        <div class="report-grid">
          <!-- IDENTIFICARE DISPOZITIV -->
          <div class="report-card">
            <h3>üì± Identificare Dispozitiv</h3>
            <% if (service9.modelDescription) { %>
              <p><strong>Model:</strong> <%= service9.modelDescription %></p>
            <% } %>
            <% if (service9.model) { %>
              <p><strong>Model complet:</strong> <%= service9.model %></p>
            <% } %>
            <% if (service9.mpn) { %>
              <p><strong>MPN (Model Part Number):</strong> <%= service9.mpn %></p>
            <% } %>
            <% if (service9.imei) { %>
              <p><strong>IMEI:</strong> <%= service9.imei %></p>
            <% } %>
            <% if (service9.imei2) { %>
              <p><strong>IMEI 2:</strong> <%= service9.imei2 %></p>
            <% } %>
            <% if (service9.serial) { %>
              <p><strong>Serial Number:</strong> <%= service9.serial %></p>
            <% } %>
            <% if (service9.productVersion) { %>
              <p><strong>Versiune software:</strong> <%= service9.productVersion %></p>
            <% } %>
          </div>
          
          <!-- PROVENIEN»öƒÇ »òI ACHIZI»öIE -->
          <div class="report-card">
            <h3>üìç Provenien»õƒÉ »ôi Achizi»õie</h3>
            <% if (service9.soldToName) { %>
              <p><strong>V√¢ndut de:</strong> <span style="color: #3b82f6; font-weight: bold;"><%= service9.soldToName %></span></p>
            <% } %>
            <% if (service9.purchaseCountry) { %>
              <p><strong>»öara de achizi»õie:</strong> <span style="color: #3b82f6; font-weight: bold;"><%= service9.purchaseCountry %></span></p>
            <% } %>
            <% if (service9.purchaseDate) { %>
              <% 
                const purchaseDate = new Date(service9.purchaseDate);
                const isValidDate = purchaseDate.getFullYear() > 2000;
              %>
              <% if (isValidDate) { %>
                <p><strong>Data achizi»õiei:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.purchaseDate) : purchaseDate.toLocaleDateString('ro-RO') %></p>
              <% } else { %>
                <p><strong>Data achizi»õiei:</strong> <span style="color: #64748b;">Nu este disponibilƒÉ</span></p>
              <% } %>
            <% } %>
            <% if (service9.firstActivationDate) { %>
              <p><strong>Prima activare:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.firstActivationDate) : new Date(service9.firstActivationDate).toLocaleDateString('ro-RO') %></p>
            <% } %>
            <% if (service9.carrier) { %>
              <p><strong>Operator SIM:</strong> <span style="color: #3b82f6; font-weight: bold;"><%= service9.carrier %></span></p>
            <% } %>
            <% if (service9.registrationDate) { %>
              <p><strong>Data √ÆnregistrƒÉrii:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.registrationDate) : new Date(service9.registrationDate).toLocaleDateString('ro-RO') %></p>
            <% } %>
          </div>
          
          <!-- STATUS GSX »òI BLO CARE -->
          <div class="report-card">
            <h3>üîì Status GSX »ôi Blocare</h3>
            <% if (service9.gsxUnlocked !== undefined) { %>
              <p><strong>GSX Unlocked:</strong> 
                <span style="color: <%= service9.gsxUnlocked ? '#22c55e' : '#ef4444' %>; font-weight: bold;">
                  <%= service9.gsxUnlocked ? 'DA - Deblocat' : 'NU - Blocat' %>
                </span>
              </p>
            <% } %>
            <% if (service9.unlockDate) { %>
              <p><strong>Data deblocare GSX:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.unlockDate) : new Date(service9.unlockDate).toLocaleDateString('ro-RO') %></p>
            <% } %>
            <% if (service9.mdmStatus !== undefined) { %>
              <p><strong>MDM Lock:</strong> 
                <span style="color: <%= service9.mdmStatus ? '#ef4444' : '#22c55e' %>; font-weight: bold;">
                  <%= service9.mdmStatus ? 'ACTIV ‚ö†Ô∏è' : 'DEZACTIVAT ‚úì' %>
                </span>
              </p>
            <% } %>
          </div>
          
          <!-- ISTORIC »òI STATUS GARAN»öIE -->
          <div class="report-card">
            <h3>üìú Istoric »ôi Garan»õie</h3>
            <% if (service9.gsxCaseHistory !== undefined) { %>
              <p><strong>Istoric cazuri GSX:</strong> 
                <span style="color: <%= service9.gsxCaseHistory > 0 ? '#ef4444' : '#22c55e' %>; font-weight: bold;">
                  <%= service9.gsxCaseHistory %> <%= service9.gsxCaseHistory > 0 ? '‚ö†Ô∏è' : '‚úì' %>
                </span>
              </p>
              <% if (service9.gsxCaseHistory > 0) { %>
                <p style="color: #f97316; font-size: 0.9em; margin-top: 5px;">‚ö†Ô∏è Dispozitivul are <%= service9.gsxCaseHistory %> caz(uri) √Æn istoricul GSX</p>
              <% } %>
            <% } %>
            <% if (service9.gsxReplacementHistory !== undefined) { %>
              <p><strong>Istoric √Ænlocuiri:</strong> 
                <span style="color: <%= service9.gsxReplacementHistory > 0 ? '#f97316' : '#22c55e' %>; font-weight: bold;">
                  <%= service9.gsxReplacementHistory %> <%= service9.gsxReplacementHistory > 0 ? '‚ö†Ô∏è' : '‚úì' %>
                </span>
              </p>
            <% } %>
            <% if (service9.replaced !== undefined) { %>
              <p><strong>√énlocuit:</strong> 
                <span style="color: <%= service9.replaced ? '#ef4444' : '#22c55e' %>; font-weight: bold;">
                  <%= service9.replaced ? 'DA ‚ö†Ô∏è' : 'NU ‚úì' %>
                </span>
              </p>
            <% } %>
            <% if (service9.loaner !== undefined) { %>
              <p><strong>Dispozitiv de √Ænlocuire (Loaner):</strong> 
                <span style="color: <%= service9.loaner ? '#f97316' : '#22c55e' %>; font-weight: bold;">
                  <%= service9.loaner ? 'DA ‚ö†Ô∏è' : 'NU ‚úì' %>
                </span>
              </p>
            <% } %>
            <% if (service9.warrantyStatusDescription) { %>
              <p><strong>Status garan»õie:</strong> 
                <span style="color: <%= service9.warrantyStatusDescription.toLowerCase().includes('out') || service9.warrantyStatusDescription.toLowerCase().includes('no coverage') ? '#f97316' : '#22c55e' %>; font-weight: bold;">
                  <%= service9.warrantyStatusDescription %>
                </span>
              </p>
            <% } %>
            <% if (service9.warrantyStatusCode) { %>
              <p><strong>Cod status garan»õie:</strong> <%= service9.warrantyStatusCode %></p>
            <% } %>
            <% if (service9.coverageStartDate) { %>
              <p><strong>Garan»õie √Ænceput:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.coverageStartDate) : new Date(service9.coverageStartDate).toLocaleDateString('ro-RO') %></p>
            <% } %>
            <% if (service9.coverageEndDate) { %>
              <p><strong>Garan»õie expirare:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.coverageEndDate) : new Date(service9.coverageEndDate).toLocaleDateString('ro-RO') %></p>
            <% } %>
            <% if (service9.contractCoverageStartDate) { %>
              <p><strong>Contract √Ænceput:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.contractCoverageStartDate) : new Date(service9.contractCoverageStartDate).toLocaleDateString('ro-RO') %></p>
            <% } %>
            <% if (service9.contractCoverageEndDate) { %>
              <p><strong>Contract expirare:</strong> <%= typeof formatDate !== 'undefined' ? formatDate(service9.contractCoverageEndDate) : new Date(service9.contractCoverageEndDate).toLocaleDateString('ro-RO') %></p>
            <% } %>
          </div>
          
          <!-- POLITICI DE ACTIVARE -->
          <div class="report-card">
            <h3>‚öôÔ∏è Politici de Activare</h3>
            <% if (service9.initialActivationPolicyDetails) { %>
              <p><strong>PoliticƒÉ ini»õialƒÉ:</strong> 
                <span style="color: <%= service9.initialActivationPolicyDetails.toLowerCase().includes('unlock') ? '#22c55e' : '#f97316' %>;">
                  <%= service9.initialActivationPolicyDetails %>
                </span>
              </p>
            <% } %>
            <% if (service9.appliedActivationDetails) { %>
              <p><strong>PoliticƒÉ aplicatƒÉ:</strong> 
                <span style="color: <%= service9.appliedActivationDetails.toLowerCase().includes('unlock') ? '#22c55e' : '#f97316' %>;">
                  <%= service9.appliedActivationDetails %>
                </span>
              </p>
            <% } %>
            <% if (service9.nextTetherPolicyDetails) { %>
              <p><strong>UrmƒÉtoarea politicƒÉ:</strong> 
                <span style="color: <%= service9.nextTetherPolicyDetails.toLowerCase().includes('unlock') ? '#22c55e' : '#f97316' %>;">
                  <%= service9.nextTetherPolicyDetails %>
                </span>
              </p>
            <% } %>
            <% if (service9.ctoConfiguration) { %>
              <p><strong>Configurare CTO:</strong> <%= service9.ctoConfiguration %></p>
            <% } %>
          </div>
        </div>
        
        <!-- ALERTE IMPORTANTE -->
        <% 
          const hasWarnings = 
            (service9.gsxCaseHistory && service9.gsxCaseHistory > 0) ||
            (service9.replaced === true) ||
            (service9.loaner === true) ||
            (service9.mdmStatus === true);
        %>
        <% if (hasWarnings) { %>
          <div style="margin-top: 20px; padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 4px solid #ef4444;">
            <h4 style="color: #ef4444; margin-bottom: 10px;">‚ö†Ô∏è Aten»õie - Probleme Identificate</h4>
            <ul style="margin-left: 20px; color: #dc2626;">
              <% if (service9.gsxCaseHistory && service9.gsxCaseHistory > 0) { %>
                <li>Dispozitivul are <%= service9.gsxCaseHistory %> caz(uri) √Æn istoricul GSX - poate indica probleme anterioare</li>
              <% } %>
              <% if (service9.replaced === true) { %>
                <li>Dispozitivul a fost √Ænlocuit - verificƒÉ legitimitatea</li>
              <% } %>
              <% if (service9.loaner === true) { %>
                <li>Dispozitivul este un dispozitiv de √Ænlocuire (loaner) - nu este dispozitivul original</li>
              <% } %>
              <% if (service9.mdmStatus === true) { %>
                <li>MDM Lock este ACTIV - dispozitivul este gestionat de o companie</li>
              <% } %>
            </ul>
          </div>
        <% } %>
      </div>
    <% } %>
  </div>
  <div class="result-actions">
    <a href="/verify/imei" class="btn btn-secondary"><%= tt('verify.result.actions.checkAnother') %></a>
    <% if (user) { %>
      <a href="/dashboard/orders" class="btn btn-primary"><%= tt('verify.result.actions.viewAll') %></a>
    <% } %>
  </div>
</div>

<% if (!isEmailView) { %>
  <%- include('../partials/footer') %>
<% } %>

