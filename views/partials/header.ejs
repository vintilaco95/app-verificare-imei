<% 
  const tFn = (typeof t === 'function')
    ? t
    : (typeof locals !== 'undefined' && typeof locals.t === 'function'
      ? locals.t
      : (key) => key);
  const currentLangValue = typeof currentLang !== 'undefined'
    ? currentLang
    : (typeof locals !== 'undefined' && typeof locals.currentLang !== 'undefined'
      ? locals.currentLang
      : 'ro');
  const currentLangLabelValue = typeof currentLangLabel !== 'undefined'
    ? currentLangLabel
    : (typeof locals !== 'undefined' && typeof locals.currentLangLabel !== 'undefined'
      ? locals.currentLangLabel
      : currentLangValue);
  const switchLangValue = typeof switchLang !== 'undefined'
    ? switchLang
    : (typeof locals !== 'undefined' && typeof locals.switchLang !== 'undefined'
      ? locals.switchLang
      : (currentLangValue === 'ro' ? 'en' : 'ro'));
  const switchLangLabelValue = typeof switchLangLabel !== 'undefined'
    ? switchLangLabel
    : (typeof locals !== 'undefined' && typeof locals.switchLangLabel !== 'undefined'
      ? locals.switchLangLabel
      : currentLangLabelValue);
  const langToggleValue = typeof langTogglePath !== 'undefined'
    ? langTogglePath
    : (typeof locals !== 'undefined' && typeof locals.langTogglePath !== 'undefined'
      ? locals.langTogglePath
      : `?lang=${switchLangValue}`);
  const isUserLoggedIn = typeof user !== 'undefined' && user;
%>
<!DOCTYPE html>
<html lang="<%= currentLangValue %>">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== 'undefined' ? title + ' - ' : '' %>Verificare IMEI</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta name="csrf-token" content="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
  <script>
    window.csrfToken = <%= JSON.stringify(typeof csrfToken !== 'undefined' ? csrfToken : '') %>;
  </script>
</head>
<body>
  <!-- Navigation -->
  <nav class="site-header" role="navigation">
    <div class="site-header__inner">
      <a href="/" class="site-header__brand" aria-label="<%= tFn('nav.brand') %>">
        <span class="site-header__logo" aria-hidden="true">
          <img
            src="/images/IMEIGUARD_LOGO.svg"
            alt=""
            class="site-header__logo-img"
            loading="lazy">
        </span>
        <span class="site-header__title <%= isUserLoggedIn ? 'site-header__title--compact' : '' %>"><%= tFn('nav.brand') %></span>
      </a>
      <div class="site-header__menu" id="site-nav" aria-hidden="true">
        <div class="site-header__menu-inner">
          <div class="site-header__primary-links">
            <% if (typeof user !== 'undefined' && user) { %>
              <a href="/" class="site-header__link"><%= tFn('nav.home') %></a>
              <a href="/dashboard" class="site-header__link"><%= tFn('nav.dashboard') %></a>
              <a href="/verify/imei" class="site-header__link"><%= tFn('nav.verify') %></a>
              <a href="/dashboard/orders" class="site-header__link"><%= tFn('nav.history') %></a>
              <form action="/auth/logout" method="POST" class="site-header__logout">
                <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
                <button type="submit" class="site-header__link site-header__link--ghost"><%= tFn('nav.logout') %></button>
              </form>
            <% } else { %>
              <a href="/" class="site-header__link"><%= tFn('nav.home') %></a>
              <a href="/verify/imei" class="site-header__link"><%= tFn('nav.verify') %></a>
              <a href="/auth/login" class="site-header__link site-header__link--ghost"><%= tFn('nav.login') %></a>
              <a href="/auth/register" class="site-header__link site-header__link--primary"><%= tFn('nav.register') %></a>
            <% } %>
          </div>
          <div class="site-header__menu-meta">
            <a
              href="<%= langToggleValue %>"
              class="site-header__link site-header__link--muted site-header__menu-lang"
              aria-label="<%= tFn('nav.language.label') %>: <%= switchLangLabelValue %>">
              <span class="site-header__flags" aria-hidden="true">
                <span class="site-header__flag <%= currentLangValue === 'ro' ? 'is-active' : '' %>">ðŸ‡·ðŸ‡´</span>
                <span class="site-header__flag <%= currentLangValue === 'en' ? 'is-active' : '' %>">ðŸ‡¬ðŸ‡§</span>
              </span>
              <span class="site-header__link-label"><%= switchLangLabelValue %></span>
            </a>
            <% if (typeof user !== 'undefined' && user) { %>
              <div class="site-header__credits site-header__credits--menu" aria-label="<%= tFn('nav.credits.balance') %>">
                <span class="site-header__credits-value"><%= user.credits.toFixed(2) %></span>
                <a href="/dashboard/credits/topup" class="site-header__credits-add" aria-label="<%= tFn('nav.credits.add') %>">+</a>
              </div>
            <% } %>
          </div>
        </div>
      </div>
      <div class="site-header__actions">
        <a
          href="<%= langToggleValue %>"
          class="site-header__action site-header__action--lang"
          aria-label="<%= tFn('nav.language.label') %>: <%= switchLangLabelValue %>">
          <span class="sr-only"><%= tFn('nav.language.toggleLabel') %></span>
          <span class="site-header__flags" aria-hidden="true">
            <span class="site-header__flag <%= currentLangValue === 'ro' ? 'is-active' : '' %>">ðŸ‡·ðŸ‡´</span>
            <span class="site-header__flag <%= currentLangValue === 'en' ? 'is-active' : '' %>">ðŸ‡¬ðŸ‡§</span>
          </span>
        </a>
        <% if (typeof user !== 'undefined' && user) { %>
          <div class="site-header__credits" aria-label="<%= tFn('nav.credits.balance') %>">
            <span class="site-header__credits-value"><%= user.credits.toFixed(2) %></span>
            <a href="/dashboard/credits/topup" class="site-header__credits-add" aria-label="<%= tFn('nav.credits.add') %>">+</a>
          </div>
        <% } %>
        <button
          class="site-header__toggle"
          id="site-nav-toggle"
          type="button"
          aria-label="<%= tFn('nav.menu.open') %>"
          aria-expanded="false"
          aria-controls="site-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </nav>
  <div class="nav-backdrop" id="nav-backdrop" hidden></div>

  <!-- Main Content -->
  <main class="main-content">
