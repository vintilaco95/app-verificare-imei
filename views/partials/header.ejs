<% 
  const tFn = (typeof t === 'function')
    ? t
    : (typeof locals !== 'undefined' && typeof locals.t === 'function'
      ? locals.t
      : (key) => key);
  const currentLangValue = typeof currentLang !== 'undefined'
    ? currentLang
    : (typeof locals !== 'undefined' && typeof locals.currentLang !== 'undefined'
      ? locals.currentLang
      : 'ro');
  const currentLangLabelValue = typeof currentLangLabel !== 'undefined'
    ? currentLangLabel
    : (typeof locals !== 'undefined' && typeof locals.currentLangLabel !== 'undefined'
      ? locals.currentLangLabel
      : currentLangValue);
  const switchLangValue = typeof switchLang !== 'undefined'
    ? switchLang
    : (typeof locals !== 'undefined' && typeof locals.switchLang !== 'undefined'
      ? locals.switchLang
      : (currentLangValue === 'ro' ? 'en' : 'ro'));
  const switchLangLabelValue = typeof switchLangLabel !== 'undefined'
    ? switchLangLabel
    : (typeof locals !== 'undefined' && typeof locals.switchLangLabel !== 'undefined'
      ? locals.switchLangLabel
      : currentLangLabelValue);
  const langToggleValue = typeof langTogglePath !== 'undefined'
    ? langTogglePath
    : (typeof locals !== 'undefined' && typeof locals.langTogglePath !== 'undefined'
      ? locals.langTogglePath
      : `?lang=${switchLangValue}`);
%>
<!DOCTYPE html>
<html lang="<%= currentLangValue %>">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== 'undefined' ? title + ' - ' : '' %>Verificare IMEI</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta name="csrf-token" content="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
  <script>
    window.csrfToken = <%= JSON.stringify(typeof csrfToken !== 'undefined' ? csrfToken : '') %>;
  </script>
</head>
<body>
  <!-- Dynamic Phone Background -->
  <canvas id="phone-canvas" class="phone-canvas" aria-hidden="true"></canvas>

  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="nav-brand" aria-label="<%= tFn('nav.brand') %>">
        <span class="nav-logo-icon">
          <span class="logo-emoji" aria-hidden="true">ğŸ¶</span>
        </span>
        <span class="nav-logo-text is-desktop"><%= tFn('nav.brand') %></span>
      </a>
      <button class="nav-toggle" type="button" aria-label="<%= tFn('nav.menu.open') %>" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="nav-mobile-meta">
        <a href="<%= langToggleValue %>" class="nav-link nav-link-lang" aria-label="<%= tFn('nav.language.label') %>: <%= switchLangLabelValue %>">
          <span class="sr-only"><%= tFn('nav.language.toggleLabel') %></span>
          <span class="lang-toggle" aria-hidden="true">
            <span class="lang-flag <%= currentLangValue === 'ro' ? 'is-active' : '' %>">ğŸ‡·ğŸ‡´</span>
            <span class="lang-flag <%= currentLangValue === 'en' ? 'is-active' : '' %>">ğŸ‡¬ğŸ‡§</span>
          </span>
        </a>
        <% if (typeof user !== 'undefined' && user) { %>
          <div class="nav-credit-pill nav-credit-pill--mobile">
            <span class="credit-icon">ğŸŒ•</span>
            <span class="credit-value"><%= user.credits.toFixed(2) %></span>
            <a href="/dashboard/credits/topup" class="credit-add" aria-label="<%= tFn('nav.credits.add') %>">+</a>
          </div>
        <% } %>
      </div>
      <div class="nav-links">
        <% if (typeof user !== 'undefined' && user) { %>
          <a href="/" class="nav-link"><%= tFn('nav.home') %></a>
          <a href="/dashboard" class="nav-link"><%= tFn('nav.dashboard') %></a>
          <a href="/verify/imei" class="nav-link"><%= tFn('nav.verify') %></a>
          <a href="/dashboard/orders" class="nav-link"><%= tFn('nav.history') %></a>
          <div class="nav-credit-pill">
            <span class="credit-icon">ğŸŒ•</span>
            <span class="credit-value"><%= user.credits.toFixed(2) %></span>
            <a href="/dashboard/credits/topup" class="credit-add" aria-label="<%= tFn('nav.credits.add') %>">+</a>
          </div>
          <form action="/auth/logout" method="POST" class="nav-form">
            <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
            <button type="submit" class="nav-link nav-link-ghost"><%= tFn('nav.logout') %></button>
          </form>
        <% } else { %>
          <a href="/" class="nav-link"><%= tFn('nav.home') %></a>
          <a href="/verify/imei" class="nav-link"><%= tFn('nav.verify') %></a>
          <a href="/auth/login" class="nav-link nav-link-ghost"><%= tFn('nav.login') %></a>
          <a href="/auth/register" class="nav-link nav-link-primary"><%= tFn('nav.register') %></a>
        <% } %>
        <a href="<%= langToggleValue %>" class="nav-link nav-link-lang" aria-label="<%= tFn('nav.language.label') %>: <%= switchLangLabelValue %>">
          <span class="sr-only"><%= tFn('nav.language.toggleLabel') %></span>
          <span class="lang-toggle" aria-hidden="true">
            <span class="lang-flag <%= currentLangValue === 'ro' ? 'is-active' : '' %>">ğŸ‡·ğŸ‡´</span>
            <span class="lang-flag <%= currentLangValue === 'en' ? 'is-active' : '' %>">ğŸ‡¬ğŸ‡§</span>
          </span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
